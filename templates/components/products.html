 {% load static %}
 
 <section class="products container section--lg">
        <p class="total__products">Siz uchun <span>688</span> ta mahsulot topdik!</p>
        
        <div class="products__container grid">
          {% for product in products %}
          <div class="product__item">
            <div class="product__banner">
              <a href="details.html" class="product__images">
                <img
                  src="{{product.image.url}}"
                  alt=""
                  class="product__img default"
                />
              </a>
              <div class="product__actions">
                <a href="#" class="action__btn" aria-label="Quick View">
                  <i class="fi fi-rs-eye"></i>
                </a>
                <a
                  href="#"
                  class="action__btn"
                  aria-label="Add to Wishlist"
                >
                  <i class="fi fi-rs-heart"></i>
                </a>
                <a href="#" class="action__btn" aria-label="Compare">
                  <i class="fi fi-rs-shuffle"></i>
                </a>
              </div>
              <div class="product__badge light-green">-{{product.discount}}%</div>
            </div>
            <div class="product__content">
              <span class="product__category">{{product.category}}</span>
              <a href="details.html">
                <h3 class="product__title">{{product.name}}</h3>
              </a>
              <div class="product__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <div class="product__price flex">
                <span class="new__price">${{product.discount_price}}</span>
                <span class="old__price">${{product.price}}</span>
              </div>
              <a
                href="#"
                class="action__btn cart__btn"
                aria-label="Add To Cart"
                data-product-id="{{product.id}}"
              >
                <i class="fi fi-rs-shopping-bag-add"></i>
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
          
      
      <ul class="pagination">
          <ul class="pagination">
              <ul class="pagination">
                {% if products.has_previous %}
                  <li><a href="?page={{ products.previous_page_number }}" class="pagination__link"><</a></li>
                {% endif %}
                {% for page in products.paginator.page_range %}
                    <li><a href="?page={{ page}}" class="pagination__link  {% if products.number == page %}active{% endif %}">{{page}}</a></li>
                {% endfor %}
                {% if products.has_next %}
                  <li><a href="?page={{ products.next_page_number }}" class="pagination__link" blank>></a></li>
                {% endif %}
              </ul>

          </ul>
      </ul>
  </section>



<script>
document.addEventListener("DOMContentLoaded", function () {
  // Barcha "Add to Cart" tugmalarini tanlab olamiz
  const cartButtons = document.querySelectorAll(".cart__btn");

  cartButtons.forEach((button) => {
    button.addEventListener("click", async (e) => {
      e.preventDefault();

      const productId = button.dataset.productId; // id olish
      const url = `/cart/${productId}/`; // so‘rov manzili

      try {
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": getCookie("csrftoken"),
          },
        });

        if (response.ok) {
          const data = await response.json();
          console.log("✅ Mahsulot savatchaga qo‘shildi:", data);
          // Masalan, savatcha sonini yangilash:
          const cartCount = document.querySelector("#cart-count");
          if (cartCount) cartCount.textContent = data.cart_count;
        } else {
          console.error("❌ Xato:", response.status);
        }
      } catch (error) {
        console.error("⚠️ Fetch xatosi:", error);
      }
    });
  });

  // Django CSRF tokenni olish funksiyasi
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
});
</script>


